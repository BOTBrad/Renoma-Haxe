(function(G){function z(){this.u=[];this.Ja(-1)}function D(c,a){this.width=c;this.height=a;this.va=[]}function H(){this.frames=0}function I(){}function J(c){this.context=c;this.pb=20}function p(){}function ca(){}function n(){}function A(c){this.xb=c;this.message=String(c);Error.captureStackTrace&&Error.captureStackTrace(this,A)}function k(c,a,b){this.x=c;this.y=a;this.z=b}function K(c,a){this.x=c;this.y=a}function L(c,a,b,d){this.M=c;this.x=a;this.y=b;this.z=d}function r(c,a,b,d,e,h,l,g,f){this.a=
c;this.g=a;this.b=b;this.c=d;this.m11=e;this.m21=h;this.f=l;this.m12=g;this.m22=f}function Q(){}function M(c,a,b,d){this.x=c;this.y=a;this.width=b;this.height=d}function E(){}function t(c,a,b,d,e){null==e&&(e=-1);this.left=c;this.key=a;this.value=b;this.right=d;this.w=-1==e?(function(b){b=b.left;return null==b?0:b.w}(this)>function(b){b=b.right;return null==b?0:b.w}(this)?function(b){b=b.left;return null==b?0:b.w}(this):function(b){b=b.right;return null==b?0:b.w}(this))+1:e}function N(){}function R(c){var a=
this;this.id=setInterval(function(){a.ka()},c)}function ha(){}function S(c){this.u=[];for(var a=0,b=c.u.length;a<b;){var d=a++;this.u.push(new y(c,d))}}function B(c,a){this.cb=c==m.J||c==m.G;this.zb=c==m.L||c==m.J;this.F=[];this.F.push({s:a.start,type:u.N});this.F.push({s:a.stop,type:u.N})}function y(c,a){this.D=a;this.floor=y.C(c.u[a]);this.ba=[];this.$=[];this.Wa(c)}function T(c,a,b){this.aa=c;this.na=a;this.ma=b}function U(c,a,b){this.j=new k(c,a,1);this.ja=b}function V(c,a){this.start=c;this.stop=
a}function W(c,a,b){this.origin=c;this.T=a;this.U=b}function O(c){F.call(this,new U(0,0,.3),c,5,Math.PI)}function F(c,a,b,d){this.o=c;this.D=a;this.heading=0;this.speed=b;this.sb=d}function X(c,a,b,d){this.pa=c;this.controller=a;this.Ma=b;this.Ia=d;this.Y=new Y(c.fa);this.v=new O(c.fa)}function da(){}function P(){}function Z(){this.V=new aa}function aa(){this.y=this.x=0;this.za=.1}function Y(c,a){null==a&&(a=6);this.eb=106;this.D=c;this.position=new k(0,0,1);this.speed=a}function q(c){this.mb=c}function ia(){}
function C(){}function ea(){}function fa(){}function w(){return n.A(this,"")}function ga(c,a){function b(){}b.prototype=c;var d=new b,e;for(e in a)d[e]=a[e];a.toString!==Object.prototype.toString&&(d.toString=a.toString);return d}fa.h=!0;fa.Pa=function(c){return{ya:0,sa:c,ab:function(){return this.ya<this.sa.length},next:function(){return this.sa[this.ya++]}}};ea.h=!0;ea.Qa=function(){var c=I.Na();c.S();var a=new R(33);a.ka=function(){c.update();c.nb()};a.ka()};Math.h=!0;C.h=!0;C.compare=function(c,
a){return c==a?0:c>a?1:-1};C.Fa=function(c){return null!=c&&null!=c.l};ia.h=!0;var x={O:!0,ra:["None","Some"],X:["None",0]};x.X.toString=w;x.X.l=x;x.qa=function(c){c=["Some",1,c];c.l=x;c.toString=w;return c};q.h=!0;q.P=[ia];q.R=function(c){return new q(x.qa(c))};q.C=function(){return new q(x.X)};q.H=function(c){return new q(x.qa(c))};q.A=function(){return new q(x.X)};q.prototype={raw:function(){return this.mb},i:q};Y.h=!0;Y.prototype={move:function(c,a){var b=this.position,d=new k(c.x,c.y,c.z);d.x-=
b.x;d.y-=b.y;d.z-=b.z;Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z)<this.speed*a||(b=Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z),0<b&&(d.x/=b,d.y/=b,d.z/=b,d),b=this.speed,d=new k(d.x,d.y,d.z),d.x*=b,d.y*=b,d.z*=b,d=new k(d.x,d.y,d.z),d.x*=a,d.y*=a,d.z*=a);b=this.position;b=new k(b.x,b.y,b.z);b.x+=d.x;b.y+=d.y;b.z+=d.z;this.position=b},Za:function(c){var a=this.eb/2,b=new k(0,0,1),d=this.position;c=new k(c.x,c.y,c.z);c.x-=d.x;c.y-=d.y;c.z-=d.z;var d=Math.PI/180*a,e=Math.sin(d/2),d=new L(Math.cos(d/2),e*b.x,e*b.y,e*b.z),
e=2*(d.x*c.x+d.y*c.y+d.z*c.z),h=d.M*d.M-d.x*d.x-d.y*d.y-d.z*d.z,l=2*d.M,a=Math.PI/180*-a,g=Math.sin(a/2),b=new L(Math.cos(a/2),g*b.x,g*b.y,g*b.z),a=2*(b.x*c.x+b.y*c.y+b.z*c.z),g=b.M*b.M-b.x*b.x-b.y*b.y-b.z*b.z,f=2*b.M;c=ba.xa(this.position,new k(e*d.x+h*c.x+l*(d.y*c.z-d.z*c.y),e*d.y+h*c.y+l*(d.z*c.x-d.x*c.z),e*d.z+h*c.z+l*(d.x*c.y-d.y*c.x)),new k(a*b.x+g*c.x+f*(b.y*c.z-b.z*c.y),a*b.y+g*c.y+f*(b.z*c.x-b.x*c.z),a*b.z+g*c.z+f*(b.x*c.y-b.y*c.x)));G.log(c);return c},i:Y};aa.h=!0;aa.prototype={Ka:function(c){return this.x=
c},La:function(c){return this.y=c},ga:function(){return this.Aa(this.x)},Z:function(){return this.Aa(this.y)},Aa:function(c){c=c-this.za*ca.sign(c);return c/=1-this.za},i:aa};Z.h=!0;Z.prototype={i:Z};P.h=!0;P.prototype={i:P};da.h=!0;da.P=[P];X.h=!0;X.prototype={S:function(){this.Ma.S(this);this.Ia.S(this);return this},update:function(){this.Ma.ia(this,.033);return this},nb:function(){this.Ia.ia(this,.033);return this},i:X};F.h=!0;F.prototype={move:function(c,a){this.rotate(c.ga()*a*this.sb);this.o.j.x+=
c.Z()*a*this.speed*Math.cos(this.heading);this.o.j.y+=c.Z()*a*this.speed*Math.sin(this.heading)},rotate:function(c){this.heading=(this.heading-c)%(2*Math.PI)},ga:function(){return this.o.j.x},Z:function(){return this.o.j.y},i:F};O.h=!0;O.ea=F;O.prototype=ga(F.prototype,{i:O});W.h=!0;W.prototype={i:W};var ba={h:!0,m:function(c,a,b){return new W(c,a,b)},xa:function(c,a,b){c=ba.m(c,a,b);a=c.T;b=c.U;b=new k(b.x,b.y,b.z);var d=b.z*a.x-b.x*a.z,e=b.x*a.y-b.y*a.x;b.x=b.y*a.z-b.z*a.y;b.y=d;b.z=e;return 0<
b.z?q.R(c):q.C()},gb:function(c,a){var b=c.origin,d=a.stop,e=new k(d.x,d.y,d.z);e.x-=b.x;e.y-=b.y;e.z-=b.z;var b=c.origin,d=a.start,h=new k(d.x,d.y,d.z);h.x-=b.x;h.y-=b.y;h.z-=b.z;if(0>function(){var b=c.U,b=new k(b.x,b.y,b.z),a=b.z*e.x-b.x*e.z,d=b.x*e.y-b.y*e.x;b.x=b.y*e.z-b.z*e.y;b.y=a;b.z=d;return b}(this).z||0>function(){var b=c.T,a=new k(h.x,h.y,h.z),d=a.z*b.x-a.x*b.z,e=a.x*b.y-a.y*b.x;a.x=a.y*b.z-a.z*b.y;a.y=d;a.z=e;return a}(this).z)return q.C();b=0<function(){var b=c.T,b=new k(b.x,b.y,b.z),
a=b.z*e.x-b.x*e.z,d=b.x*e.y-b.y*e.x;b.x=b.y*e.z-b.z*e.y;b.y=a;b.z=d;return b}(this).z?c.T:e;d=0>function(){var b=c.U,b=new k(b.x,b.y,b.z),a=b.z*h.x-b.x*h.z,d=b.x*h.y-b.y*h.x;b.x=b.y*h.z-b.z*h.y;b.y=a;b.z=d;return b}(this).z?c.U:h;return ba.xa(c.origin,b,d)}};V.h=!0;V.prototype={i:V};var v={h:!0,m:function(c,a){return new V(c,a)},Da:function(c){var a=c.stop;c=c.start;c=new k(c.x,c.y,c.z);c.x-=a.x;c.y-=a.y;c.z-=a.z;return Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z)},normalize:function(c){var a=1/v.Da(c);return v.m(c.start,
function(){var b=c.start,d=c.stop,d=new k(d.x,d.y,d.z);d.x-=b.x;d.y-=b.y;d.z-=b.z;b=new k(d.x,d.y,d.z);b.x*=a;b.y*=a;b.z*=a;d=c.start;d=new k(d.x,d.y,d.z);d.x+=b.x;d.y+=b.y;d.z+=b.z;return d}(this))},jb:function(c,a){var b=c.start,d=c.stop,e=new k(d.x,d.y,d.z);e.x-=b.x;e.y-=b.y;e.z-=b.z;var h=e.x*e.x+e.y*e.y+e.z*e.z;if(0==h)return q.A();var l;l=function(){var c=new k(a.x,a.y,a.z);c.x-=b.x;c.y-=b.y;c.z-=b.z;return c.x*e.x+c.y*e.y+c.z*e.z}(this)/h;d=0>=l?v.m(b,a):1<=l?v.m(d,a):v.m(function(){var a=
new k(e.x,e.y,e.z);a.x*=l;a.y*=l;a.z*=l;var c=new k(b.x,b.y,b.z);c.x+=a.x;c.y+=a.y;c.z+=a.z;return c}(this),a);return q.H(d)}};U.h=!0;U.prototype={bb:function(c){var a;c=v.jb(c,this.j).raw();switch(c[1]){case 0:return q.A();case 1:a=c[2]}var b=v.Da(a);return b>this.ja?q.A():q.H(function(c){var e=c.ja-b,h=v.normalize(a);return v.m(h.start,function(){var b=h.start,a=h.stop,a=new k(a.x,a.y,a.z);a.x-=b.x;a.y-=b.y;a.z-=b.z;b=new k(a.x,a.y,a.z);b.x*=e;b.y*=e;b.z*=e;a=h.start;a=new k(a.x,a.y,a.z);a.x+=b.x;
a.y+=b.y;a.z+=b.z;return a}(c))}(this))},i:U};T.h=!0;T.prototype={i:T};y.h=!0;y.C=function(c){return new M(-c.width/2,-c.height/2,c.width,c.height)};y.H=function(c){var a=c.height/2,b=c.width/2;c=new E;var d=new B(m.J,v.m(new k(b,a,1),new k(-b,a,1)));c.set(m.J,d);d=new B(m.G,v.m(new k(-b,-a,1),new k(b,-a,1)));c.set(m.G,d);d=new B(m.I,v.m(new k(b,-a,1),new k(b,a,1)));c.set(m.I,d);a=new B(m.L,v.m(new k(-b,a,1),new k(-b,-a,1)));c.set(m.L,a);return c};y.prototype={Wa:function(c){for(var a=c.u[this.D],
b=y.H(a),d=0,a=a.va;d<a.length;){var e=a[d];++d;var h=this.$a(c,e);b.get(e.direction).Ua(h.aa);this.$.push(h)}for(c=b.iterator();c.ab();)b=c.next(),this.ba=this.ba.concat(b.Ya())},$a:function(c,a){var b=c.u[this.D],d=c.u[a.Ga],e=new k(0,0,0),h,l,g=b.width/2,b=b.height/2,f=d.width/2,d=d.height/2;switch(a.direction[1]){case 0:e.y=b+d;h=new k(Math.min(g,f),b,1);l=new k(Math.max(-g,-f),b,1);break;case 1:e.y=-(b+d);h=new k(Math.max(-g,-f),-b,1);l=new k(Math.min(g,f),-b,1);break;case 2:e.x=g+f;h=new k(g,
Math.max(-b,-d),1);l=new k(g,Math.min(b,d),1);break;case 3:e.x=-(g+f),h=new k(-g,Math.min(b,d),1),l=new k(-g,Math.max(-b,-d),1)}return new T(v.m(h,l),p.Sa(e),a.Ga)},i:y};var u={O:!0,ra:["WallPoint","StartPortal","StopPortal"],N:["WallPoint",0]};u.N.toString=w;u.N.l=u;u.ca=["StartPortal",1];u.ca.toString=w;u.ca.l=u;u.da=["StopPortal",2];u.da.toString=w;u.da.l=u;B.h=!0;B.prototype={Ua:function(c){this.F.push({s:c.start,type:u.ca});this.F.push({s:c.stop,type:u.da})},Ya:function(){this.F.sort(this.cb?
function(b,a){return b.s.x<a.s.x?-1:b.s.x>a.s.x?1:0}:function(b,a){return b.s.y<a.s.y?-1:b.s.y>a.s.y?1:0});var c=[],a=!1,b=0;try{for(;b<this.F.length;){var d=this.F[b];switch(d.type[1]){case 0:var e=d.s;a||c.push(e);b++;throw"__break__";case 1:a=!a;break;case 2:a=!a}b++}}catch(k){if("__break__"!=k)throw k;}d=u.N;try{for(;b<this.F.length;){var h=this.F[b],l=h.type;switch(h.type[1]){case 0:var g=h.s;a||c.push(g);throw"__break__";default:var f=h.s;l==d?G.log("Overlapping portals!"):(a=!a,c.push(f))}b++}}catch(k){if("__break__"!=
k)throw k;}this.zb&&c.reverse();0!=c.length%2&&G.log("we have an odd number of stops");a=[];b=0;for(h=c.length/2|0;b<h;)l=b++,a.push(v.m(c[2*l],c[2*l+1]));return a},i:B};S.h=!0;S.prototype={i:S};ha.h=!0;R.h=!0;R.prototype={ka:function(){},i:R};N.h=!0;N.prototype={set:function(c,a){this.root=this.la(c,a,this.root)},get:function(c){for(var a=this.root;null!=a;){var b=this.compare(c,a.key);if(0==b)return a.value;a=0>b?a.left:a.right}return null},iterator:function(){var c=[];this.ha(this.root,c);return fa.Pa(c)},
la:function(c,a,b){if(null==b)return new t(null,c,a,null);var d=this.compare(c,b.key);if(0==d)return new t(b.left,c,a,b.right,null==b?0:b.w);if(0>d)return c=this.la(c,a,b.left),this.ta(c,b.key,b.value,b.right);c=this.la(c,a,b.right);return this.ta(b.left,b.key,b.value,c)},ha:function(c,a){null!=c&&(this.ha(c.left,a),a.push(c.value),this.ha(c.right,a))},ta:function(c,a,b,d){var e;null==c?e=0:e=c.w;var h;null==d?h=0:h=d.w;return e>h+2?function(){var b=c.left;return null==b?0:b.w}(this)>=function(){var b=
c.right;return null==b?0:b.w}(this)?new t(c.left,c.key,c.value,new t(c.right,a,b,d)):new t(new t(c.left,c.key,c.value,c.right.left),c.right.key,c.right.value,new t(c.right.right,a,b,d)):h>e+2?function(){var b=d.right;return null==b?0:b.w}(this)>function(){var b=d.left;return null==b?0:b.w}(this)?new t(new t(c,a,b,d.left),d.key,d.value,d.right):new t(new t(c,a,b,d.left.left),d.left.key,d.left.value,new t(d.left.right,d.key,d.value,d.right)):new t(c,a,b,d,(e>h?e:h)+1)},compare:function(c,a){return C.compare(c,
a)},i:N};t.h=!0;t.prototype={i:t};E.h=!0;E.P=[ha];E.ea=N;E.prototype=ga(N.prototype,{compare:function(c,a){var b=c[1]-a[1];if(0!=b)return b;var b=c.slice(2),d=a.slice(2);return 0==b.length&&0==d.length?0:this.ua(b,d)},ua:function(c,a){var b=c.length-a.length;if(0!=b)return b;for(var b=0,d=c.length;b<d;){var e=b++,e=this.Xa(c[e],a[e]);if(0!=e)return e}return 0},Xa:function(c,a){return C.Fa(c)&&C.Fa(a)?this.compare(c,a):c instanceof Array&&null==c.l&&a instanceof Array&&null==a.l?this.ua(c,a):C.compare(c,
a)},i:E});M.h=!0;M.prototype={wa:function(c){return Q.Ea(this.x,this.width,c.x)&&Q.Ea(this.y,this.height,c.y)},Ca:function(c){var a=new K(this.x,this.y);switch(c){case 0:break;case 1:a.x+=this.width;break;case 2:a.x+=this.width;a.y+=this.height;break;case 3:a.y+=this.height;break;default:throw new A("Invalid vertex index.");}return a},i:M};Q.h=!0;Q.Ea=function(c,a,b){return b>=c&&b<=c+a};r.h=!0;r.prototype={i:r};L.h=!0;L.prototype={i:L};K.h=!0;K.prototype={i:K};k.h=!0;k.prototype={i:k};A.h=!0;A.ea=
Error;A.prototype=ga(Error.prototype,{i:A});n.h=!0;n.yb=function(c){if(c instanceof Array&&null==c.l)return Array;var a=c.i;if(null!=a)return a;c=n.Ba(c);return null!=c?n.kb(c):null};n.A=function(c,a){if(null==c)return"null";if(5<=a.length)return"<...>";var b=typeof c;"function"==b&&(c.h||c.O)&&(b="object");switch(b){case "object":if(c instanceof Array){if(c.l){if(2==c.length)return c[0];b=c[0]+"(";a+="\t";for(var d=2,e=c.length;d<e;){var h=d++;2!=h?b+=","+n.A(c[h],a):b+=n.A(c[h],a)}return b+")"}b=
c.length;d="[";a+="\t";for(e=0;e<b;)h=e++,d+=(0<h?",":"")+n.A(c[h],a);return d+"]"}try{d=c.toString}catch(l){return l instanceof A&&(l=l.xb),"???"}if(null!=d&&d!=Object.toString&&"function"==typeof d&&(b=c.toString(),"[object Object]"!=b))return b;b=null;d="{\n";a+="\t";e=null!=c.hasOwnProperty;for(b in c)e&&!c.hasOwnProperty(b)||"prototype"==b||"__class__"==b||"__super__"==b||"__interfaces__"==b||"__properties__"==b||(2!=d.length&&(d+=", \n"),d+=a+b+" : "+n.A(c[b],a));a=a.substring(1);return d+("\n"+
a+"}");case "function":return"<function>";case "string":return c;default:return String(c)}};n.H=function(c,a){if(null==c)return!1;if(c==a)return!0;var b=c.P;if(null!=b)for(var d=0,e=b.length;d<e;){var h=d++,h=b[h];if(h==a||n.H(h,a))return!0}return n.H(c.ea,a)};n.hb=function(c){var a=KeyboardEvent;if(null==a)return!1;switch(a){case la:return(c|0)===c;case ja:return"number"==typeof c;case ka:return"boolean"==typeof c;case String:return"string"==typeof c;case Array:return c instanceof Array&&null==c.l;
case ma:return!0;default:if(null!=c)if("function"==typeof a){if(c instanceof a||n.H(n.yb(c),a))return!0}else{if("object"==typeof a&&n.ib(a)&&c instanceof a)return!0}else return!1;return a==na&&null!=c.h||a==oa&&null!=c.O?!0:c.l==a}};n.Ba=function(c){c=n.lb.call(c).slice(8,-1);return"Object"==c||"Function"==c||"Math"==c||"JSON"==c?null:c};n.ib=function(c){return null!=n.Ba(c)};n.kb=function(c){return Function("return typeof "+c+' != "undefined" ? '+c+" : null")()};ca.h=!0;ca.sign=function(c){return 0>
c?-1:0<c?1:0};p.h=!0;p.C=function(){var c=new r(1,0,0,0,1,0,0,0,1);return new r(c.a,c.g,c.b,c.c,c.m11,c.m21,c.f,c.m12,c.m22)};p.R=function(c,a){var b=p.C();b.b=c;b.m21=a;return b};p.Sa=function(c){return p.R(c.x,c.y)};p.wb=function(){var c=p.C();c.a=10;c.m11=10;return c};p.Ra=function(){var c=p.C();c.a=1;c.m11=-1;return c};p.Ta=function(c,a){var b=a.Ca(0),d=a.Ca(2),b=new k(b.x,b.y,1),b=new k(c.a*b.x+c.g*b.y+c.b*b.z,c.c*b.x+c.m11*b.y+c.m21*b.z,c.f*b.x+c.m12*b.y+c.m22*b.z),d=new k(d.x,d.y,1),d=new k(c.a*
d.x+c.g*d.y+c.b*d.z,c.c*d.x+c.m11*d.y+c.m21*d.z,c.f*d.x+c.m12*d.y+c.m22*d.z);return new M(b.x,b.y,d.x-b.x,d.y-b.y)};p.Oa=function(c){c=new r(c.a,c.g,c.b,c.c,c.m11,c.m21,c.f,c.m12,c.m22);c.a=1/c.a;c.m11=1/c.m11;c.b=-c.b;c.m21=-c.m21;return c};J.h=!0;J.P=[P];J.prototype={S:function(c){this.W=c.W},ia:function(c){this.context.clearRect(0,0,854,480);var a;a=p.R(427,240);var b=p.Ra();a=new r(a.a*b.a+a.g*b.c+a.b*b.f,a.a*b.g+a.g*b.m11+a.b*b.m12,a.a*b.b+a.g*b.m21+a.b*b.m22,a.c*b.a+a.m11*b.c+a.m21*b.f,a.c*
b.g+a.m11*b.m11+a.m21*b.m12,a.c*b.b+a.m11*b.m21+a.m21*b.m22,a.f*b.a+a.m12*b.c+a.m22*b.f,a.f*b.g+a.m12*b.m11+a.m22*b.m12,a.f*b.b+a.m12*b.m21+a.m22*b.m22);b=p.wb();a=new r(a.a*b.a+a.g*b.c+a.b*b.f,a.a*b.g+a.g*b.m11+a.b*b.m12,a.a*b.b+a.g*b.m21+a.b*b.m22,a.c*b.a+a.m11*b.c+a.m21*b.f,a.c*b.g+a.m11*b.m11+a.m21*b.m12,a.c*b.b+a.m11*b.m21+a.m21*b.m22,a.f*b.a+a.m12*b.c+a.m22*b.f,a.f*b.g+a.m12*b.m11+a.m22*b.m12,a.f*b.b+a.m12*b.m21+a.m22*b.m22);b=p.R(-c.v.ga(),-c.v.Z());this.B=new r(a.a*b.a+a.g*b.c+a.b*b.f,a.a*
b.g+a.g*b.m11+a.b*b.m12,a.a*b.b+a.g*b.m21+a.b*b.m22,a.c*b.a+a.m11*b.c+a.m21*b.f,a.c*b.g+a.m11*b.m11+a.m21*b.m12,a.c*b.b+a.m11*b.m21+a.m21*b.m22,a.f*b.a+a.m12*b.c+a.m22*b.f,a.f*b.g+a.m12*b.m11+a.m22*b.m12,a.f*b.b+a.m12*b.m21+a.m22*b.m22);this.Ha(c.Y.Za(c.v.o.j),c.v.D,p.C(),c.v)},Ha:function(c,a,b,d){var e;c=c.raw();switch(c[1]){case 0:return;case 1:e=c[2]}this.qb(e,b);if(!(function(){var a=new k(0,0,1),c=e.origin,a=new k(b.a*a.x+b.g*a.y+b.b*a.z,b.c*a.x+b.m11*a.y+b.m21*a.z,b.f*a.x+b.m12*a.y+b.m22*a.z),
a=new k(a.x,a.y,a.z);a.x-=c.x;a.y-=c.y;a.z-=c.z;return Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)}(this)>this.pb))for(this.rb(a,b,d),c=0,a=this.W.u[a].$;c<a.length;){var h=a[c];++c;this.Ha(ba.gb(e,function(a){var c=h.aa;return v.m(function(){var a=c.start;return new k(b.a*a.x+b.g*a.y+b.b*a.z,b.c*a.x+b.m11*a.y+b.m21*a.z,b.f*a.x+b.m12*a.y+b.m22*a.z)}(a),function(){var a=c.stop;return new k(b.a*a.x+b.g*a.y+b.b*a.z,b.c*a.x+b.m11*a.y+b.m21*a.z,b.f*a.x+b.m12*a.y+b.m22*a.z)}(a))}(this)),h.ma,function(){var a=h.na;
return new r(b.a*a.a+b.g*a.c+b.b*a.f,b.a*a.g+b.g*a.m11+b.b*a.m12,b.a*a.b+b.g*a.m21+b.b*a.m22,b.c*a.a+b.m11*a.c+b.m21*a.f,b.c*a.g+b.m11*a.m11+b.m21*a.m12,b.c*a.b+b.m11*a.m21+b.m21*a.m22,b.f*a.a+b.m12*a.c+b.m22*a.f,b.f*a.g+b.m12*a.m11+b.m22*a.m12,b.f*a.b+b.m12*a.m21+b.m22*a.m22)}(this),d)}},qb:function(c){var a;a=this.B;var b=c.U,b=new k(b.x,b.y,b.z);b.x*=100;b.y*=100;b.z*=100;var d=c.origin,d=new k(d.x,d.y,d.z);d.x+=b.x;d.y+=b.y;d.z+=b.z;a=new k(a.a*d.x+a.g*d.y+a.b*d.z,a.c*d.x+a.m11*d.y+a.m21*d.z,
a.f*d.x+a.m12*d.y+a.m22*d.z);b=this.B;d=c.T;d=new k(d.x,d.y,d.z);d.x*=100;d.y*=100;d.z*=100;var e=c.origin,e=new k(e.x,e.y,e.z);e.x+=d.x;e.y+=d.y;e.z+=d.z;b=new k(b.a*e.x+b.g*e.y+b.b*e.z,b.c*e.x+b.m11*e.y+b.m21*e.z,b.f*e.x+b.m12*e.y+b.m22*e.z);d=this.B;c=c.origin;c=new k(d.a*c.x+d.g*c.y+d.b*c.z,d.c*c.x+d.m11*c.y+d.m21*c.z,d.f*c.x+d.m12*c.y+d.m22*c.z);this.context.strokeStyle="#6666FF";this.context.beginPath();this.context.moveTo(a.x,a.y);this.context.lineTo(c.x,c.y);this.context.lineTo(b.x,b.y);this.context.stroke()},
rb:function(c,a,b){var d=this.W.u[c];this.context.strokeStyle="#000000";this.context.beginPath();for(var e=0,h=d.ba;e<h.length;){var l=h[e];++e;var g;g=this.B;g=new r(g.a*a.a+g.g*a.c+g.b*a.f,g.a*a.g+g.g*a.m11+g.b*a.m12,g.a*a.b+g.g*a.m21+g.b*a.m22,g.c*a.a+g.m11*a.c+g.m21*a.f,g.c*a.g+g.m11*a.m11+g.m21*a.m12,g.c*a.b+g.m11*a.m21+g.m21*a.m22,g.f*a.a+g.m12*a.c+g.m22*a.f,g.f*a.g+g.m12*a.m11+g.m22*a.m12,g.f*a.b+g.m12*a.m21+g.m22*a.m22);var f=l.start;g=new k(g.a*f.x+g.g*f.y+g.b*f.z,g.c*f.x+g.m11*f.y+g.m21*
f.z,g.f*f.x+g.m12*f.y+g.m22*f.z);f=this.B;f=new r(f.a*a.a+f.g*a.c+f.b*a.f,f.a*a.g+f.g*a.m11+f.b*a.m12,f.a*a.b+f.g*a.m21+f.b*a.m22,f.c*a.a+f.m11*a.c+f.m21*a.f,f.c*a.g+f.m11*a.m11+f.m21*a.m12,f.c*a.b+f.m11*a.m21+f.m21*a.m22,f.f*a.a+f.m12*a.c+f.m22*a.f,f.f*a.g+f.m12*a.m11+f.m22*a.m12,f.f*a.b+f.m12*a.m21+f.m22*a.m22);l=l.stop;l=new k(f.a*l.x+f.g*l.y+f.b*l.z,f.c*l.x+f.m11*l.y+f.m21*l.z,f.f*l.x+f.m12*l.y+f.m22*l.z);this.context.moveTo(g.x,g.y);this.context.lineTo(l.x,l.y)}this.context.stroke();this.context.strokeStyle=
"#00FF00";this.context.beginPath();e=0;for(h=d.$;e<h.length;)l=h[e],++e,g=this.B,g=new r(g.a*a.a+g.g*a.c+g.b*a.f,g.a*a.g+g.g*a.m11+g.b*a.m12,g.a*a.b+g.g*a.m21+g.b*a.m22,g.c*a.a+g.m11*a.c+g.m21*a.f,g.c*a.g+g.m11*a.m11+g.m21*a.m12,g.c*a.b+g.m11*a.m21+g.m21*a.m22,g.f*a.a+g.m12*a.c+g.m22*a.f,g.f*a.g+g.m12*a.m11+g.m22*a.m12,g.f*a.b+g.m12*a.m21+g.m22*a.m22),f=l.aa.start,g=new k(g.a*f.x+g.g*f.y+g.b*f.z,g.c*f.x+g.m11*f.y+g.m21*f.z,g.f*f.x+g.m12*f.y+g.m22*f.z),f=this.B,f=new r(f.a*a.a+f.g*a.c+f.b*a.f,f.a*
a.g+f.g*a.m11+f.b*a.m12,f.a*a.b+f.g*a.m21+f.b*a.m22,f.c*a.a+f.m11*a.c+f.m21*a.f,f.c*a.g+f.m11*a.m11+f.m21*a.m12,f.c*a.b+f.m11*a.m21+f.m21*a.m22,f.f*a.a+f.m12*a.c+f.m22*a.f,f.f*a.g+f.m12*a.m11+f.m22*a.m12,f.f*a.b+f.m12*a.m21+f.m22*a.m22),l=l.aa.stop,l=new k(f.a*l.x+f.g*l.y+f.b*l.z,f.c*l.x+f.m11*l.y+f.m21*l.z,f.f*l.x+f.m12*l.y+f.m22*l.z),this.context.moveTo(g.x,g.y),this.context.lineTo(l.x,l.y);this.context.stroke();e=this.B;e=new r(e.a*a.a+e.g*a.c+e.b*a.f,e.a*a.g+e.g*a.m11+e.b*a.m12,e.a*a.b+e.g*a.m21+
e.b*a.m22,e.c*a.a+e.m11*a.c+e.m21*a.f,e.c*a.g+e.m11*a.m11+e.m21*a.m12,e.c*a.b+e.m11*a.m21+e.m21*a.m22,e.f*a.a+e.m12*a.c+e.m22*a.f,e.f*a.g+e.m12*a.m11+e.m22*a.m12,e.f*a.b+e.m12*a.m21+e.m22*a.m22);h=new k(0,0,1);e=new k(e.a*h.x+e.g*h.y+e.b*h.z,e.c*h.x+e.m11*h.y+e.m21*h.z,e.f*h.x+e.m12*h.y+e.m22*h.z);this.context.fillText(null==c?"null":""+c,e.x,e.y);b.D==d.D&&this.ob(b,a)},ob:function(c,a){var b=c.o,d;d=b.j;d=new k(d.x,d.y,d.z);var e;e=d;e=new k(e.x,e.y,e.z);e.x+=b.ja;b=this.B;b=new r(b.a*a.a+b.g*a.c+
b.b*a.f,b.a*a.g+b.g*a.m11+b.b*a.m12,b.a*a.b+b.g*a.m21+b.b*a.m22,b.c*a.a+b.m11*a.c+b.m21*a.f,b.c*a.g+b.m11*a.m11+b.m21*a.m12,b.c*a.b+b.m11*a.m21+b.m21*a.m22,b.f*a.a+b.m12*a.c+b.m22*a.f,b.f*a.g+b.m12*a.m11+b.m22*a.m12,b.f*a.b+b.m12*a.m21+b.m22*a.m22);d=new k(b.a*d.x+b.g*d.y+b.b*d.z,b.c*d.x+b.m11*d.y+b.m21*d.z,b.f*d.x+b.m12*d.y+b.m22*d.z);b=this.B;b=new r(b.a*a.a+b.g*a.c+b.b*a.f,b.a*a.g+b.g*a.m11+b.b*a.m12,b.a*a.b+b.g*a.m21+b.b*a.m22,b.c*a.a+b.m11*a.c+b.m21*a.f,b.c*a.g+b.m11*a.m11+b.m21*a.m12,b.c*a.b+
b.m11*a.m21+b.m21*a.m22,b.f*a.a+b.m12*a.c+b.m22*a.f,b.f*a.g+b.m12*a.m11+b.m22*a.m12,b.f*a.b+b.m12*a.m21+b.m22*a.m22);e=new k(b.a*e.x+b.g*e.y+b.b*e.z,b.c*e.x+b.m11*e.y+b.m21*e.z,b.f*e.x+b.m12*e.y+b.m22*e.z);e=new k(e.x,e.y,e.z);e.x-=d.x;e.y-=d.y;e.z-=d.z;e=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);this.context.strokeStyle="#FF0000";this.context.beginPath();this.context.arc(d.x,d.y,e,0,2*Math.PI);this.context.stroke()},i:J};I.h=!0;I.Na=function(){var c=window.document.createElement("canvas");c.width=854;c.height=
480;window.document.body.appendChild(c);return new X(I.pa(),new Z,new H,new J(c.getContext("2d",null)))};I.pa=function(){for(var c=new z,a=0;4>a;){var b=a++;c.Va(D.A(5+2*b%3,5+b%3))}c.K(0,1,m.I);c.K(1,2,m.I);c.K(1,3,m.G);c.K(3,2,m.G);c.Ja(1);return c};H.h=!0;H.P=[da];H.prototype={S:function(c){this.fb(c);c.W=new S(c.pa)},ia:function(c,a){this.vb(c,a);this.ub(c,a);this.frames++},vb:function(c,a){var b=c.v,d=c.W.u,e=d[c.v.D];b.move(c.controller.V,a);for(var h=b.o,l=0,g=e.ba;l<g.length;){var f=g[l];
++l;f=h.bb(f).raw();switch(f[1]){case 1:f=f[2],h.j.x+=f.stop.x-f.start.x,h.j.y+=f.stop.y-f.start.y}}h=new K(c.v.o.j.x,c.v.o.j.y);if(!e.floor.wa(h))for(l=0,g=e.$;l<g.length;)if(e=g[l],++l,p.Ta(e.na,d[e.ma].floor).wa(h)){d=p.Oa(e.na);b.D=e.ma;e=b.o.j;b.o.j=new k(d.a*e.x+d.g*e.y+d.b*e.z,d.c*e.x+d.m11*e.y+d.m21*e.z,d.f*e.x+d.m12*e.y+d.m22*e.z);b=c.Y.position;c.Y.position=new k(d.a*b.x+d.g*b.y+d.b*b.z,d.c*b.x+d.m11*b.y+d.m21*b.z,d.f*b.x+d.m12*b.y+d.m22*b.z);break}},ub:function(c,a){var b=new k(Math.cos(c.v.heading),
Math.sin(c.v.heading),0),b=new k(b.x,b.y,b.z);b.x*=2;b.y*=2;b.z*=2;var d=c.v.o.j,d=new k(d.x,d.y,d.z);d.x-=b.x;d.y-=b.y;d.z-=b.z;c.Y.move(d,a)},fb:function(c){function a(a){if(n.hb(a)){var d;d="keydown"==a.type?1:0;switch(a.keyCode){case 87:c.controller.V.La(d);break;case 83:c.controller.V.La(-d);break;case 65:c.controller.V.Ka(-d);break;case 68:c.controller.V.Ka(d)}}}window.document.body.addEventListener("keydown",a,!1);window.document.body.addEventListener("keyup",a,!1)},i:H};D.h=!0;D.A=function(c,
a){return new D(c,a)};D.prototype={K:function(c,a){this.va.push({direction:a,Ga:c})},i:D};var m={O:!0,ra:["North","South","East","West"],J:["North",0]};m.J.toString=w;m.J.l=m;m.G=["South",1];m.G.toString=w;m.G.l=m;m.I=["East",2];m.I.toString=w;m.I.l=m;m.L=["West",3];m.L.toString=w;m.L.l=m;z.h=!0;z.Ab=function(){return-1};z.tb=function(c){switch(c[1]){case 0:return m.G;case 1:return m.J;case 2:return m.L;case 3:return m.I}};z.prototype={Va:function(c){return this.u.push(c)-1},K:function(c,a,b){this.oa(c)&&
this.oa(a)?(this.u[c].K(a,b),this.u[a].K(c,z.tb(b))):G.log("Invalid connection created")},Ja:function(c){this.oa(c)||G.log("Invalid default room");return this.fa=c},oa:function(c){return 0<=c&&c<this.u.length},i:z};String.prototype.i=String;String.h=!0;Array.h=!0;var la={h:["Int"]},ma={h:["Dynamic"]},ja=Number;ja.h=["Float"];var ka=Boolean;ka.O=["Bool"];var na={h:["Class"]},oa={};n.lb={}.toString;ea.Qa()})("undefined"!=typeof console?console:{log:function(){}});
