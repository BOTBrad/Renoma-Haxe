(function(J){function A(){this.s=[];this.Wa(-1)}function G(a,d){this.width=a;this.height=d;this.Da=[]}function K(){this.frames=0}function L(){}function M(a){this.context=ka.bb(a);this.da=[];this.Aa=3;this.context.viewport(0,0,a.width,a.height)}function w(){}function la(){}function ka(){}function q(){}function B(a){this.Qb=a;this.message=String(a);Error.captureStackTrace&&Error.captureStackTrace(this,B)}function r(a,d,b,c){this.x=a;this.y=d;this.z=b;this.b=c}function g(a,d,b){this.x=a;this.y=d;this.z=
b}function N(a,d){this.x=a;this.y=d}function O(a,d,b,c){this.T=a;this.x=d;this.y=b;this.z=c}function P(a,d,b,c,e,f,h,n,l,sa,g,ta,ua,k,m,q){this.g=a;this.j=d;this.f=b;this.Oa=c;this.h=e;this.m11=f;this.m21=h;this.m31=n;this.i=l;this.m12=sa;this.m22=g;this.m32=ta;this.Na=ua;this.m13=k;this.m23=m;this.m33=q}function C(a,d,b,c,e,f,h,n,l){this.g=a;this.j=d;this.f=b;this.h=c;this.m11=e;this.m21=f;this.i=h;this.m12=n;this.m22=l}function W(){}function Q(a,d,b,c){this.x=a;this.y=d;this.width=b;this.height=
c}function H(){}function u(a,d,b,c,e){null==e&&(e=-1);this.left=a;this.key=d;this.value=b;this.right=c;this.A=-1==e?(function(a){a=a.left;return null==a?0:a.A}(this)>function(a){a=a.right;return null==a?0:a.A}(this)?function(a){a=a.left;return null==a?0:a.A}(this):function(a){a=a.right;return null==a?0:a.A}(this))+1:e}function R(){}function X(a){var d=this;this.id=setInterval(function(){d.ra()},a)}function pa(){}function Y(a){this.s=[];for(var d=0,b=a.s.length;d<b;){var c=d++;this.s.push(new z(a,
c))}}function D(a,d){this.yb=a==k.K||a==k.F;this.Rb=a==k.P||a==k.K;this.D=[];this.D.push({v:d.start,type:v.U});this.D.push({v:d.stop,type:v.U})}function z(a,d){this.H=d;this.floor=z.M(a.s[d]);this.I=[];this.pa=[];this.nb(a)}function Z(a,d,b){this.Va=a;this.ea=d;this.ta=b}function aa(){this.I=[];this.xa=[]}function E(a,d){this.origin=a;this.G=d}function ba(a,d,b){this.m=new g(a,d,1);this.Ra=b}function ca(a,d){this.start=a;this.stop=d}function S(a,d){this.origin=a;this.G=d}function T(){}function da(a,
d,b){this.origin=a;this.X=d;this.Y=b}function U(a){I.call(this,new ba(0,0,.3),a,5,Math.PI)}function I(a,d,b,c){this.w=a;this.H=d;this.heading=0;this.speed=b;this.Lb=c}function ea(a,d,b,c){this.fa=a;this.Sa=20;this.S=new aa;this.controller=d;this.Za=b;this.Ua=c;this.N=new fa(a.la);this.C=new U(a.la)}function ga(){}function ha(){}function ia(){this.Z=new ja}function ja(){this.y=this.x=0;this.Ha=.1}function fa(a,d){null==d&&(d=6);this.zb=106;this.H=a;this.position=new g(0,0,1);this.speed=d}function m(a){this.oa=
a}function F(){}function ma(){}function na(){}function y(){return q.u(this,"")}function oa(a,d){function b(){}b.prototype=a;var c=new b,e;for(e in d)c[e]=d[e];d.toString!==Object.prototype.toString&&(c.toString=d.toString);return c}na.a=!0;na.fb=function(a){return{Ga:0,ya:a,wb:function(){return this.Ga<this.ya.length},next:function(){return this.ya[this.Ga++]}}};ma.a=!0;ma.hb=function(){var a=L.cb();a.W();var d=new X(33);d.ra=function(){a.update();a.qa()};d.ra()};Math.a=!0;F.a=!0;F.compare=function(a,
d){return a==d?0:a>d?1:-1};F.ca=function(a){return null!=a&&null!=a.o};var x={V:!0,wa:["None","Some"],O:["None",0]};x.O.toString=y;x.O.o=x;x.ga=function(a){a=["Some",1,a];a.o=x;a.toString=y;return a};m.a=!0;m.ma=function(a){return new m(x.ga(a))};m.M=function(){return new m(x.O)};m.B=function(a){return new m(x.ga(a))};m.u=function(){return new m(x.O)};m.R=function(){return new m(x.O)};m.ca=function(a){return new m(x.ga(a))};m.ba=function(){return new m(x.O)};m.prototype={sb:function(a){var d=this.oa;
switch(d[1]){case 0:return m.ba();case 1:return m.ca(a(d[2]))}},ob:function(a){var d=this.oa;switch(d[1]){case 0:return m.R();case 1:return a(d[2])}},raw:function(){return this.oa},c:m};fa.a=!0;fa.prototype={move:function(a,d){var b=this.position,c=new g(a.x,a.y,a.z);c.x-=b.x;c.y-=b.y;c.z-=b.z;Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z)<this.speed*d||(b=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z),0<b&&(c.x/=b,c.y/=b,c.z/=b,c),b=this.speed,c=new g(c.x,c.y,c.z),c.x*=b,c.y*=b,c.z*=b,c=new g(c.x,c.y,c.z),c.x*=d,c.y*=d,
c.z*=d);b=this.position;b=new g(b.x,b.y,b.z);b.x+=c.x;b.y+=c.y;b.z+=c.z;this.position=b},tb:function(a){var d=this.zb/2,b=new g(0,0,1),c=this.position;a=new g(a.x,a.y,a.z);a.x-=c.x;a.y-=c.y;a.z-=c.z;var c=Math.PI/180*d,e=Math.sin(c/2),c=new O(Math.cos(c/2),e*b.x,e*b.y,e*b.z),e=2*(c.x*a.x+c.y*a.y+c.z*a.z),f=c.T*c.T-c.x*c.x-c.y*c.y-c.z*c.z,h=2*c.T,d=Math.PI/180*-d,n=Math.sin(d/2),b=new O(Math.cos(d/2),n*b.x,n*b.y,n*b.z),d=2*(b.x*a.x+b.y*a.y+b.z*a.z),n=b.T*b.T-b.x*b.x-b.y*b.y-b.z*b.z,l=2*b.T;return V.Fa(this.position,
new g(e*c.x+f*a.x+h*(c.y*a.z-c.z*a.y),e*c.y+f*a.y+h*(c.z*a.x-c.x*a.z),e*c.z+f*a.z+h*(c.x*a.y-c.y*a.x)),new g(d*b.x+n*a.x+l*(b.y*a.z-b.z*a.y),d*b.y+n*a.y+l*(b.z*a.x-b.x*a.z),d*b.z+n*a.z+l*(b.x*a.y-b.y*a.x)))},c:fa};ja.a=!0;ja.prototype={Xa:function(a){return this.x=a},Ya:function(a){return this.y=a},vb:function(){return this.Ia(this.x)},Ma:function(){return this.Ia(this.y)},Ia:function(a){a=a-this.Ha*la.sign(a);return a/=1-this.Ha},c:ja};ia.a=!0;ia.prototype={c:ia};ha.a=!0;ha.prototype={c:ha};ga.a=
!0;ga.prototype={c:ga};ea.a=!0;ea.prototype={W:function(){this.Za.W(this);this.Ua.W(this);this.S.N=this.N;return this},update:function(){this.Za.Kb(this,.033);return this},qa:function(){this.S.clear();this.Ta(this.N.tb(this.C.w.m),this.C.H,w.ba(),this.C);var a=this.C.w.m;this.S.target=new g(a.x,a.y,a.z);this.Ua.qa(this.S);return this},Ta:function(a,d,b,c){var e=this,f;a=a.raw();switch(a[1]){case 0:return;case 1:f=a[2]}a=this.fa.s[d];if(!(function(){var a=new g(0,0,1),c=f.origin,a=new g(b.g*a.x+b.j*
a.y+b.f*a.z,b.h*a.x+b.m11*a.y+b.m21*a.z,b.i*a.x+b.m12*a.y+b.m22*a.z),a=new g(a.x,a.y,a.z);a.x-=c.x;a.y-=c.y;a.z-=c.z;return Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)}(this)-a.width-a.height>this.Sa)){c.H==d&&this.S.xa.push({Tb:c,ea:b});a=0;for(var h=this.va.s[d].I;a<h.length;){var n=h[a];++a;V.aa(f,t.l(function(){var a=n.start;return new g(b.g*a.x+b.j*a.y+b.f*a.z,b.h*a.x+b.m11*a.y+b.m21*a.z,b.i*a.x+b.m12*a.y+b.m22*a.z)}(this),function(){var a=n.stop;return new g(b.g*a.x+b.j*a.y+b.f*a.z,b.h*a.x+b.m11*a.y+
b.m21*a.z,b.i*a.x+b.m12*a.y+b.m22*a.z)}(this))).sb(function(a){e.S.I.push(a)})}a=0;for(d=this.va.s[d].pa;a<d.length;){var l=d[a];++a;this.Ta(V.Db(f,function(a){var c=l.Va;return t.l(function(){var a=c.start;return new g(b.g*a.x+b.j*a.y+b.f*a.z,b.h*a.x+b.m11*a.y+b.m21*a.z,b.i*a.x+b.m12*a.y+b.m22*a.z)}(a),function(){var a=c.stop;return new g(b.g*a.x+b.j*a.y+b.f*a.z,b.h*a.x+b.m11*a.y+b.m21*a.z,b.i*a.x+b.m12*a.y+b.m22*a.z)}(a))}(this)),l.ta,function(){var a=l.ea;return new C(b.g*a.g+b.j*a.h+b.f*a.i,b.g*
a.j+b.j*a.m11+b.f*a.m12,b.g*a.f+b.j*a.m21+b.f*a.m22,b.h*a.g+b.m11*a.h+b.m21*a.i,b.h*a.j+b.m11*a.m11+b.m21*a.m12,b.h*a.f+b.m11*a.m21+b.m21*a.m22,b.i*a.g+b.m12*a.h+b.m22*a.i,b.i*a.j+b.m12*a.m11+b.m22*a.m12,b.i*a.f+b.m12*a.m21+b.m22*a.m22)}(this),c)}}},c:ea};I.a=!0;I.prototype={move:function(a,d){this.rotate(a.vb()*d*this.Lb);this.w.m.x+=a.Ma()*d*this.speed*Math.cos(this.heading);this.w.m.y+=a.Ma()*d*this.speed*Math.sin(this.heading)},rotate:function(a){this.heading=(this.heading-a)%(2*Math.PI)},c:I};
U.a=!0;U.ka=I;U.prototype=oa(I.prototype,{c:U});da.a=!0;da.prototype={c:da};var V={a:!0,l:function(a,d,b){return new da(a,d,b)},Fa:function(a,d,b){a=V.l(a,d,b);d=a.X;b=a.Y;b=new g(b.x,b.y,b.z);var c=b.z*d.x-b.x*d.z,e=b.x*d.y-b.y*d.x;b.x=b.y*d.z-b.z*d.y;b.y=c;b.z=e;return 0<b.z?m.ma(a):m.M()},Db:function(a,d){var b=a.origin,c=d.stop,e=new g(c.x,c.y,c.z);e.x-=b.x;e.y-=b.y;e.z-=b.z;var b=a.origin,c=d.start,f=new g(c.x,c.y,c.z);f.x-=b.x;f.y-=b.y;f.z-=b.z;if(0>function(){var b=a.Y,b=new g(b.x,b.y,b.z),
c=b.z*e.x-b.x*e.z,d=b.x*e.y-b.y*e.x;b.x=b.y*e.z-b.z*e.y;b.y=c;b.z=d;return b}(this).z&&0>function(){var b=a.X,c=new g(f.x,f.y,f.z),d=c.z*b.x-c.x*b.z,e=c.x*b.y-c.y*b.x;c.x=c.y*b.z-c.z*b.y;c.y=d;c.z=e;return c}(this).z)return m.M();b=0<function(){var b=a.X,b=new g(b.x,b.y,b.z),c=b.z*e.x-b.x*e.z,d=b.x*e.y-b.y*e.x;b.x=b.y*e.z-b.z*e.y;b.y=c;b.z=d;return b}(this).z?a.X:e;c=0>function(){var b=a.Y,b=new g(b.x,b.y,b.z),c=b.z*f.x-b.x*f.z,d=b.x*f.y-b.y*f.x;b.x=b.y*f.z-b.z*f.y;b.y=c;b.z=d;return b}(this).z?a.Y:
f;return V.Fa(a.origin,b,c)},aa:function(a,d){return E.u(a.origin,a.Y).aa(d).ob(function(b){var c=a.X;return E.u(a.origin,new g(-c.x,-c.y,-c.z)).aa(b)})}};T.a=!0;T.Mb=function(a,d){var b=d-a;return new P(1,0,0,0,0,1,0,0,0,0,(d+a)/b,1,0,0,-2*d*a/b,0)};T.gb=function(a,d){var b=new g(a.position.x,a.position.y,1),c=new g(d.x,d.y,d.z);c.x-=b.x;c.y-=b.y;c.z-=b.z;var e;e=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z);0<e&&(c.x/=e,c.y/=e,c.z/=e,c);var f=new g(0,0,1);e=new g(c.x,c.y,c.z);var h=e.z*f.x-e.x*f.z,n=e.x*f.y-
e.y*f.x;e.x=e.y*f.z-e.z*f.y;e.y=h;e.z=n;f=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);0<f&&(e.x/=f,e.y/=f,e.z/=f,e);f=new g(e.x,e.y,e.z);h=f.z*c.x-f.x*c.z;n=f.x*c.y-f.y*c.x;f.x=f.y*c.z-f.z*c.y;f.y=h;f.z=n;return new P(e.x,e.y,e.z,-(e.x*b.x+e.y*b.y+e.z*b.z),f.x,f.y,f.z,-(f.x*b.x+f.y*b.y+f.z*b.z),-c.x,-c.y,-c.z,c.x*b.x+c.y*b.y+c.z*b.z,0,0,0,1)};S.a=!0;S.prototype={Ba:function(a){for(var d=this,b=a.map(function(a){var b=d.G,c=d.origin;a=new r(a.x,a.y,a.z,a.b);a.x-=c.x;a.y-=c.y;a.z-=c.z;a.b-=c.b;return 0>b.x*
a.x+b.y*a.y+b.z*a.z+b.b*a.b}),c=[],e=0,f=a.length;e<f;){var h=e++,n=(h+1)%a.length;if(!b[h]||!b[n]){if(b[n]||b[h]){var l=a[h],g,h=a[n],h=new r(h.x,h.y,h.z,h.b);h.x-=l.x;h.y-=l.y;h.z-=l.z;h.b-=l.b;g=h;var h=function(a){var b=a.G;a=a.origin;a=new r(a.x,a.y,a.z,a.b);a.x-=l.x;a.y-=l.y;a.z-=l.z;a.b-=l.b;return b.x*a.x+b.y*a.y+b.z*a.z+b.b*a.b}(this)/function(a){a=a.G;return a.x*g.x+a.y*g.y+a.z*g.z+a.b*g.b}(this),p=g,p=new r(p.x,p.y,p.z,p.b);p.x*=h;p.y*=h;p.z*=h;p.b*=h;h=p;p=l;p=new r(p.x,p.y,p.z,p.b);p.x+=
h.x;p.y+=h.y;p.z+=h.z;p.b+=h.b;c.push(p)}b[n]||c.push(a[n])}}return c},c:S};ca.a=!0;ca.prototype={c:ca};var t={a:!0,l:function(a,d){return new ca(a,d)},La:function(a){var d=a.stop;a=a.start;a=new g(a.x,a.y,a.z);a.x-=d.x;a.y-=d.y;a.z-=d.z;return Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)},normalize:function(a){var d=1/t.La(a);return t.l(a.start,function(){var b=a.start,c=a.stop,c=new g(c.x,c.y,c.z);c.x-=b.x;c.y-=b.y;c.z-=b.z;b=new g(c.x,c.y,c.z);b.x*=d;b.y*=d;b.z*=d;c=a.start;c=new g(c.x,c.y,c.z);c.x+=b.x;
c.y+=b.y;c.z+=b.z;return c}(this))},Gb:function(a,d){var b=a.start,c=a.stop,e=new g(c.x,c.y,c.z);e.x-=b.x;e.y-=b.y;e.z-=b.z;var f=e.x*e.x+e.y*e.y+e.z*e.z;if(0==f)return m.u();var h;h=function(){var a=new g(d.x,d.y,d.z);a.x-=b.x;a.y-=b.y;a.z-=b.z;return a.x*e.x+a.y*e.y+a.z*e.z}(this)/f;c=0>=h?t.l(b,d):1<=h?t.l(c,d):t.l(function(){var a=new g(e.x,e.y,e.z);a.x*=h;a.y*=h;a.z*=h;var c=new g(b.x,b.y,b.z);c.x+=a.x;c.y+=a.y;c.z+=a.z;return c}(this),d);return m.B(c)}};ba.a=!0;ba.prototype={xb:function(a){var d;
a=t.Gb(a,this.m).raw();switch(a[1]){case 0:return m.u();case 1:d=a[2]}var b=t.La(d);return b>this.Ra?m.u():m.B(function(a){var e=a.Ra-b,f=t.normalize(d);return t.l(f.start,function(){var a=f.start,b=f.stop,b=new g(b.x,b.y,b.z);b.x-=a.x;b.y-=a.y;b.z-=a.z;a=new g(b.x,b.y,b.z);a.x*=e;a.y*=e;a.z*=e;b=f.start;b=new g(b.x,b.y,b.z);b.x+=a.x;b.y+=a.y;b.z+=a.z;return b}(a))}(this))},c:ba};E.a=!0;E.u=function(a,d){return new E(a,new g(-d.y,d.x,0))};E.prototype={aa:function(a){var d;d=0>function(b){var c=b.G;
b=b.origin;var d=a.start,d=new g(d.x,d.y,d.z);d.x-=b.x;d.y-=b.y;d.z-=b.z;return c.x*d.x+c.y*d.y+c.z*d.z}(this);var b;b=0>function(b){var c=b.G;b=b.origin;var d=a.stop,d=new g(d.x,d.y,d.z);d.x-=b.x;d.y-=b.y;d.z-=b.z;return c.x*d.x+c.y*d.y+c.z*d.z}(this);if(d&&b)return m.u();if(!d&&!b)return m.B(a);var c=a.start,e=a.stop,f=new g(e.x,e.y,e.z);f.x-=c.x;f.y-=c.y;f.z-=c.z;e=function(b){var c=b.G,d=a.start;b=b.origin;b=new g(b.x,b.y,b.z);b.x-=d.x;b.y-=d.y;b.z-=d.z;return c.x*b.x+c.y*b.y+c.z*b.z}(this)/function(a){a=
a.G;return a.x*f.x+a.y*f.y+a.z*f.z}(this);c=new g(f.x,f.y,f.z);c.x*=e;c.y*=e;c.z*=e;e=a.start;e=new g(e.x,e.y,e.z);e.x+=c.x;e.y+=c.y;e.z+=c.z;if(d)return m.B(t.l(e,a.stop));if(b)return m.B(t.l(a.start,e));J.log("This should never be hit");return m.u()},c:E};aa.a=!0;aa.prototype={clear:function(){this.I=[];this.xa=[]},c:aa};Z.a=!0;Z.prototype={c:Z};z.a=!0;z.M=function(a){return new Q(-a.width/2,-a.height/2,a.width,a.height)};z.R=function(a){var d=a.height/2,b=a.width/2;a=new H;var c=new D(k.K,t.l(new g(b,
d,1),new g(-b,d,1)));a.set(k.K,c);c=new D(k.F,t.l(new g(-b,-d,1),new g(b,-d,1)));a.set(k.F,c);c=new D(k.J,t.l(new g(b,-d,1),new g(b,d,1)));a.set(k.J,c);d=new D(k.P,t.l(new g(-b,d,1),new g(-b,-d,1)));a.set(k.P,d);return a};z.prototype={nb:function(a){for(var d=a.s[this.H],b=z.R(d),c=0,d=d.Da;c<d.length;){var e=d[c];++c;var f=this.ub(a,e);b.get(e.direction).lb(f.Va);this.pa.push(f)}for(a=b.iterator();a.wb();)b=a.next(),this.I=this.I.concat(b.rb())},ub:function(a,d){var b=a.s[this.H],c=a.s[d.Qa],e=new g(0,
0,0),f,h,n=b.width/2,b=b.height/2,l=c.width/2,c=c.height/2;switch(d.direction[1]){case 0:e.y=b+c;f=new g(Math.min(n,l),b,1);h=new g(Math.max(-n,-l),b,1);break;case 1:e.y=-(b+c);f=new g(Math.max(-n,-l),-b,1);h=new g(Math.min(n,l),-b,1);break;case 2:e.x=n+l;f=new g(n,Math.max(-b,-c),1);h=new g(n,Math.min(b,c),1);break;case 3:e.x=-(n+l),f=new g(-n,Math.min(b,c),1),h=new g(-n,Math.max(-b,-c),1)}return new Z(t.l(f,h),w.jb(e),d.Qa)},c:z};var v={V:!0,wa:["WallPoint","StartPortal","StopPortal"],U:["WallPoint",
0]};v.U.toString=y;v.U.o=v;v.ha=["StartPortal",1];v.ha.toString=y;v.ha.o=v;v.ia=["StopPortal",2];v.ia.toString=y;v.ia.o=v;D.a=!0;D.prototype={lb:function(a){this.D.push({v:a.start,type:v.ha});this.D.push({v:a.stop,type:v.ia})},rb:function(){this.D.sort(this.yb?function(a,b){return a.v.x<b.v.x?-1:a.v.x>b.v.x?1:0}:function(a,b){return a.v.y<b.v.y?-1:a.v.y>b.v.y?1:0});var a=[],d=!1,b=0;try{for(;b<this.D.length;){var c=this.D[b];switch(c.type[1]){case 0:var e=c.v;d||a.push(e);b++;throw"__break__";case 1:d=
!d;break;case 2:d=!d}b++}}catch(g){if("__break__"!=g)throw g;}c=v.U;try{for(;b<this.D.length;){var f=this.D[b],h=f.type;switch(f.type[1]){case 0:var n=f.v;d||a.push(n);throw"__break__";default:var l=f.v;h==c?J.log("Overlapping portals!"):(d=!d,a.push(l))}b++}}catch(g){if("__break__"!=g)throw g;}this.Rb&&a.reverse();0!=a.length%2&&J.log("we have an odd number of stops");d=[];b=0;for(f=a.length/2|0;b<f;)h=b++,d.push(t.l(a[2*h],a[2*h+1]));return d},c:D};Y.a=!0;Y.prototype={c:Y};pa.a=!0;X.a=!0;X.prototype=
{ra:function(){},c:X};R.a=!0;R.prototype={set:function(a,d){this.root=this.sa(a,d,this.root)},get:function(a){for(var d=this.root;null!=d;){var b=this.compare(a,d.key);if(0==b)return d.value;d=0>b?d.left:d.right}return null},iterator:function(){var a=[];this.na(this.root,a);return na.fb(a)},sa:function(a,d,b){if(null==b)return new u(null,a,d,null);var c=this.compare(a,b.key);if(0==c)return new u(b.left,a,d,b.right,null==b?0:b.A);if(0>c)return a=this.sa(a,d,b.left),this.za(a,b.key,b.value,b.right);
a=this.sa(a,d,b.right);return this.za(b.left,b.key,b.value,a)},na:function(a,d){null!=a&&(this.na(a.left,d),d.push(a.value),this.na(a.right,d))},za:function(a,d,b,c){var e;null==a?e=0:e=a.A;var f;null==c?f=0:f=c.A;return e>f+2?function(){var b=a.left;return null==b?0:b.A}(this)>=function(){var b=a.right;return null==b?0:b.A}(this)?new u(a.left,a.key,a.value,new u(a.right,d,b,c)):new u(new u(a.left,a.key,a.value,a.right.left),a.right.key,a.right.value,new u(a.right.right,d,b,c)):f>e+2?function(){var a=
c.right;return null==a?0:a.A}(this)>function(){var a=c.left;return null==a?0:a.A}(this)?new u(new u(a,d,b,c.left),c.key,c.value,c.right):new u(new u(a,d,b,c.left.left),c.left.key,c.left.value,new u(c.left.right,c.key,c.value,c.right)):new u(a,d,b,c,(e>f?e:f)+1)},compare:function(a,d){return F.compare(a,d)},c:R};u.a=!0;u.prototype={c:u};H.a=!0;H.ja=[pa];H.ka=R;H.prototype=oa(R.prototype,{compare:function(a,d){var b=a[1]-d[1];if(0!=b)return b;var b=a.slice(2),c=d.slice(2);return 0==b.length&&0==c.length?
0:this.Ca(b,c)},Ca:function(a,d){var b=a.length-d.length;if(0!=b)return b;for(var b=0,c=a.length;b<c;){var e=b++,e=this.pb(a[e],d[e]);if(0!=e)return e}return 0},pb:function(a,d){return F.ca(a)&&F.ca(d)?this.compare(a,d):a instanceof Array&&null==a.o&&d instanceof Array&&null==d.o?this.Ca(a,d):F.compare(a,d)},c:H});Q.a=!0;Q.prototype={Ea:function(a){return W.R(this.x,this.width,a.x)&&W.R(this.y,this.height,a.y)},Ka:function(a){var d=new N(this.x,this.y);switch(a){case 0:break;case 1:d.x+=this.width;
break;case 2:d.x+=this.width;d.y+=this.height;break;case 3:d.y+=this.height;break;default:throw new B("Invalid vertex index.");}return d},c:Q};W.a=!0;W.R=function(a,d,b){return b>=a&&b<=a+d};C.a=!0;C.prototype={c:C};P.a=!0;P.prototype={c:P};O.a=!0;O.prototype={c:O};N.a=!0;N.prototype={c:N};g.a=!0;g.prototype={c:g};r.a=!0;r.prototype={c:r};B.a=!0;B.ka=Error;B.prototype=oa(Error.prototype,{c:B});q.a=!0;q.Pb=function(a){if(a instanceof Array&&null==a.o)return Array;var d=a.c;if(null!=d)return d;a=q.M(a);
return null!=a?q.Fb(a):null};q.u=function(a,d){if(null==a)return"null";if(5<=d.length)return"<...>";var b=typeof a;"function"==b&&(a.a||a.V)&&(b="object");switch(b){case "object":if(a instanceof Array){if(a.o){if(2==a.length)return a[0];b=a[0]+"(";d+="\t";for(var c=2,e=a.length;c<e;){var f=c++;2!=f?b+=","+q.u(a[f],d):b+=q.u(a[f],d)}return b+")"}b=a.length;c="[";d+="\t";for(e=0;e<b;)f=e++,c+=(0<f?",":"")+q.u(a[f],d);return c+"]"}try{c=a.toString}catch(h){return h instanceof B&&(h=h.Qb),"???"}if(null!=
c&&c!=Object.toString&&"function"==typeof c&&(b=a.toString(),"[object Object]"!=b))return b;b=null;c="{\n";d+="\t";e=null!=a.hasOwnProperty;for(b in a)e&&!a.hasOwnProperty(b)||"prototype"==b||"__class__"==b||"__super__"==b||"__interfaces__"==b||"__properties__"==b||(2!=c.length&&(c+=", \n"),c+=d+b+" : "+q.u(a[b],d));d=d.substring(1);return c+("\n"+d+"}");case "function":return"<function>";case "string":return a;default:return String(a)}};q.B=function(a,d){if(null==a)return!1;if(a==d)return!0;var b=
a.ja;if(null!=b)for(var c=0,e=b.length;c<e;){var f=c++,f=b[f];if(f==d||q.B(f,d))return!0}return q.B(a.ka,d)};q.ma=function(a){var d=KeyboardEvent;if(null==d)return!1;switch(d){case va:return(a|0)===a;case qa:return"number"==typeof a;case ra:return"boolean"==typeof a;case String:return"string"==typeof a;case Array:return a instanceof Array&&null==a.o;case wa:return!0;default:if(null!=a)if("function"==typeof d){if(a instanceof d||q.B(q.Pb(a),d))return!0}else{if("object"==typeof d&&q.Eb(d)&&a instanceof
d)return!0}else return!1;return d==xa&&null!=a.a||d==ya&&null!=a.V?!0:a.o==d}};q.M=function(a){a=q.Hb.call(a).slice(8,-1);return"Object"==a||"Function"==a||"Math"==a||"JSON"==a?null:a};q.Eb=function(a){return null!=q.M(a)};q.Fb=function(a){return Function("return typeof "+a+' != "undefined" ? '+a+" : null")()};ka.a=!0;ka.bb=function(a){for(var d=0,b=["webgl","experimental-webgl"];d<b.length;){var c=b[d];++d;c=a.getContext(c,null);if(null!=c)return c}return null};la.a=!0;la.sign=function(a){return 0>
a?-1:0<a?1:0};w.a=!0;w.ba=function(){var a=new C(1,0,0,0,1,0,0,0,1);return new C(a.g,a.j,a.f,a.h,a.m11,a.m21,a.i,a.m12,a.m22)};w.ib=function(a,d){var b=w.ba();b.f=a;b.m21=d;return b};w.jb=function(a){return w.ib(a.x,a.y)};w.kb=function(a,d){var b=d.Ka(0),c=d.Ka(2),b=new g(b.x,b.y,1),b=new g(a.g*b.x+a.j*b.y+a.f*b.z,a.h*b.x+a.m11*b.y+a.m21*b.z,a.i*b.x+a.m12*b.y+a.m22*b.z),c=new g(c.x,c.y,1),c=new g(a.g*c.x+a.j*c.y+a.f*c.z,a.h*c.x+a.m11*c.y+a.m21*c.z,a.i*c.x+a.m12*c.y+a.m22*c.z);return new Q(b.x,b.y,
c.x-b.x,c.y-b.y)};w.eb=function(a){a=new C(a.g,a.j,a.f,a.h,a.m11,a.m21,a.i,a.m12,a.m22);a.g=1/a.g;a.m11=1/a.m11;a.f=-a.f;a.m21=-a.m21;return a};M.a=!0;M.ja=[ga];M.prototype={W:function(a){this.Pa=.5;this.Ja=a.Sa;this.Ib=new S(new r(0,0,-this.Pa,1),new r(0,0,-1,0));this.qb=new S(new r(0,0,-this.Ja,1),new r(0,0,1,0));this.Cb();this.Ab();this.context.clearColor(0,0,0,1)},qa:function(a){var d=this;this.da=[];var b=T.gb(a.N,a.target),c=0;for(a=a.I;c<a.length;){var e=a[c];++c;var f=new r(e.start.x,e.start.y,
0,1),e=new r(e.stop.x,e.stop.y,0,1),h;h=f;h=new r(h.x,h.y,h.z,h.b);var g;g=e;g=new r(g.x,g.y,g.z,g.b);h.z=this.Aa;g.z=this.Aa;this.da.push([f,h,e]);this.da.push([e,h,g])}var l=T.Mb(this.Pa,this.Ja),c=this.da.map(function(a){a=a.map(function(a){return new r(b.g*a.x+b.j*a.y+b.f*a.z+b.Oa*a.b,b.h*a.x+b.m11*a.y+b.m21*a.z+b.m31*a.b,b.i*a.x+b.m12*a.y+b.m22*a.z+b.m32*a.b,b.Na*a.x+b.m13*a.y+b.m23*a.z+b.m33*a.b)});return d.qb.Ba(d.Ib.Ba(a)).map(function(a){return new r(l.g*a.x+l.j*a.y+l.f*a.z+l.Oa*a.b,l.h*
a.x+l.m11*a.y+l.m21*a.z+l.m31*a.b,l.i*a.x+l.m12*a.y+l.m22*a.z+l.m32*a.b,l.Na*a.x+l.m13*a.y+l.m23*a.z+l.m33*a.b)})});a=[];for(e=f=0;e<c.length;)if(h=c[e],++e,3!=h.length)4==h.length&&(c.push([h[0],h[1],h[3]]),c.push([h[1],h[2],h[3]]));else for(g=0;g<h.length;){var k=h[g];++g;var m=1/k.b,k=new r(k.x,k.y,k.z,k.b);k.x*=m;k.y*=m;k.z*=m;k.b*=m;a.push(k.x);a.push(k.y);a.push(k.z);f++}this.context.bindBuffer(34962,this.$a);this.context.bufferData(34962,new Float32Array(a),35044);this.context.clear(16640);
this.context.enable(2929);this.context.bindBuffer(34962,this.$a);this.context.vertexAttribPointer(this.ab,3,5126,!1,0,0);this.context.drawArrays(4,0,f)},Cb:function(){var a=this.context.createShader(35633),d=this.context.createShader(35632);this.context.shaderSource(a,"attribute vec4 a_Position;\n      void main() {\n        gl_Position = a_Position;\n      }");this.context.shaderSource(d,"void main() {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n      }");this.context.compileShader(a);this.context.compileShader(d);
this.$=this.context.createProgram();this.context.attachShader(this.$,a);this.context.attachShader(this.$,d);this.context.linkProgram(this.$);this.context.useProgram(this.$);this.ab=this.context.getAttribLocation(this.$,"a_Position");this.context.enableVertexAttribArray(this.ab)},Ab:function(){this.$a=this.context.createBuffer()},c:M};L.a=!0;L.cb=function(){var a=window.document.createElement("canvas");a.width=854;a.height=480;window.document.body.appendChild(a);return new ea(L.fa(),new ia,new K,new M(a))};
L.fa=function(){for(var a=new A,d=0;4>d;){var b=d++;a.mb(G.B(5+2*b%3,5+b%3))}a.L(0,1,k.J);a.L(1,2,k.J);a.L(1,3,k.F);a.L(3,2,k.F);a.Wa(1);return a};K.a=!0;K.ja=[ha];K.prototype={W:function(a){this.Bb(a);a.va=new Y(a.fa)},Kb:function(a,d){this.Ob(a,d);this.Nb(a,d);this.frames++},Ob:function(a,d){var b=a.C,c=a.va.s,e=c[a.C.H];b.move(a.controller.Z,d);for(var f=b.w,h=0,k=e.I;h<k.length;){var l=k[h];++h;l=f.xb(l).raw();switch(l[1]){case 1:l=l[2],f.m.x+=l.stop.x-l.start.x,f.m.y+=l.stop.y-l.start.y}}f=new N(a.C.w.m.x,
a.C.w.m.y);if(!e.floor.Ea(f))for(h=0,k=e.pa;h<k.length;)if(e=k[h],++h,w.kb(e.ea,c[e.ta].floor).Ea(f)){c=w.eb(e.ea);b.H=e.ta;e=b.w.m;b.w.m=new g(c.g*e.x+c.j*e.y+c.f*e.z,c.h*e.x+c.m11*e.y+c.m21*e.z,c.i*e.x+c.m12*e.y+c.m22*e.z);b=a.N.position;a.N.position=new g(c.g*b.x+c.j*b.y+c.f*b.z,c.h*b.x+c.m11*b.y+c.m21*b.z,c.i*b.x+c.m12*b.y+c.m22*b.z);break}},Nb:function(a,d){var b=new g(Math.cos(a.C.heading),Math.sin(a.C.heading),0),b=new g(b.x,b.y,b.z);b.x*=2;b.y*=2;b.z*=2;var c=a.C.w.m,c=new g(c.x,c.y,c.z);
c.x-=b.x;c.y-=b.y;c.z-=b.z;a.N.move(c,d)},Bb:function(a){function d(b){if(q.ma(b)){var c;c="keydown"==b.type?1:0;switch(b.keyCode){case 87:a.controller.Z.Ya(c);break;case 83:a.controller.Z.Ya(-c);break;case 65:a.controller.Z.Xa(-c);break;case 68:a.controller.Z.Xa(c)}}}window.document.body.addEventListener("keydown",d,!1);window.document.body.addEventListener("keyup",d,!1)},c:K};G.a=!0;G.B=function(a,d){return new G(a,d)};G.prototype={L:function(a,d){this.Da.push({direction:d,Qa:a})},c:G};var k={V:!0,
wa:["North","South","East","West"],K:["North",0]};k.K.toString=y;k.K.o=k;k.F=["South",1];k.F.toString=y;k.F.o=k;k.J=["East",2];k.J.toString=y;k.J.o=k;k.P=["West",3];k.P.toString=y;k.P.o=k;A.a=!0;A.Sb=function(){return-1};A.Jb=function(a){switch(a[1]){case 0:return k.F;case 1:return k.K;case 2:return k.P;case 3:return k.J}};A.prototype={mb:function(a){return this.s.push(a)-1},L:function(a,d,b){this.ua(a)&&this.ua(d)?(this.s[a].L(d,b),this.s[d].L(a,A.Jb(b))):J.log("Invalid connection created")},Wa:function(a){this.ua(a)||
J.log("Invalid default room");return this.la=a},ua:function(a){return 0<=a&&a<this.s.length},c:A};String.prototype.c=String;String.a=!0;Array.a=!0;var va={a:["Int"]},wa={a:["Dynamic"]},qa=Number;qa.a=["Float"];var ra=Boolean;ra.V=["Bool"];var xa={a:["Class"]},ya={};null==Array.prototype.map&&(Array.prototype.map=function(a){for(var d=[],b=0,c=this.length;b<c;){var e=b++;d[e]=a(this[e])}return d});q.Hb={}.toString;ma.hb()})("undefined"!=typeof console?console:{log:function(){}});
